import{_ as s,o as n,c as a,a as l}from"./app.8ab4289c.js";const i=JSON.parse('{"title":"\u524D\u7AEF\u6587\u6863doc","description":"","frontmatter":{"title":"\u524D\u7AEF\u6587\u6863doc","editLink":true},"headers":[{"level":2,"title":"\u4E00\u3001\u603B\u63FD","slug":"\u4E00\u3001\u603B\u63FD","link":"#\u4E00\u3001\u603B\u63FD","children":[]},{"level":2,"title":"\u4E8C\u3001ubuntu \u7CFB\u7EDF\u521D\u59CB\u5316\u914D\u7F6E","slug":"\u4E8C\u3001ubuntu-\u7CFB\u7EDF\u521D\u59CB\u5316\u914D\u7F6E","link":"#\u4E8C\u3001ubuntu-\u7CFB\u7EDF\u521D\u59CB\u5316\u914D\u7F6E","children":[]},{"level":2,"title":"\u4E09\u3001\u5B89\u88C5\u5BB9\u5668\u8FD0\u884C\u65F6","slug":"\u4E09\u3001\u5B89\u88C5\u5BB9\u5668\u8FD0\u884C\u65F6","link":"#\u4E09\u3001\u5B89\u88C5\u5BB9\u5668\u8FD0\u884C\u65F6","children":[]},{"level":2,"title":"\u56DB\u3001\u5B89\u88C5&\u90E8\u7F72 k8s \u96C6\u7FA4","slug":"\u56DB\u3001\u5B89\u88C5-\u90E8\u7F72-k8s-\u96C6\u7FA4","link":"#\u56DB\u3001\u5B89\u88C5-\u90E8\u7F72-k8s-\u96C6\u7FA4","children":[]},{"level":2,"title":"\u56DE\u9000 k8s \u96C6\u7FA4/\u91CD\u7F6E k8s \u96C6\u7FA4","slug":"\u56DE\u9000-k8s-\u96C6\u7FA4-\u91CD\u7F6E-k8s-\u96C6\u7FA4","link":"#\u56DE\u9000-k8s-\u96C6\u7FA4-\u91CD\u7F6E-k8s-\u96C6\u7FA4","children":[]}],"relativePath":"devOpsDoc/k8s.md"}'),p={name:"devOpsDoc/k8s.md"},o=l(`<h1 id="kubernetes" tabindex="-1">Kubernetes <a class="header-anchor" href="#kubernetes" aria-hidden="true">#</a></h1><h2 id="\u4E00\u3001\u603B\u63FD" tabindex="-1">\u4E00\u3001\u603B\u63FD <a class="header-anchor" href="#\u4E00\u3001\u603B\u63FD" aria-hidden="true">#</a></h2><ul><li>\u57FA\u4E8E ubuntu24.04</li><li>k8s \u96C6\u7FA4\u81F3\u5C11\u51C6\u5907 3 \u53F0\u673A\u5668\uFF0C\u4E00\u53F0 master\uFF0C\u4E24\u53F0 worker\u3002</li></ul><h2 id="\u4E8C\u3001ubuntu-\u7CFB\u7EDF\u521D\u59CB\u5316\u914D\u7F6E" tabindex="-1">\u4E8C\u3001ubuntu \u7CFB\u7EDF\u521D\u59CB\u5316\u914D\u7F6E <a class="header-anchor" href="#\u4E8C\u3001ubuntu-\u7CFB\u7EDF\u521D\u59CB\u5316\u914D\u7F6E" aria-hidden="true">#</a></h2><p>IP \u89C4\u5212<br> \u51C6\u5907 root \u7528\u6237<br> \u8BBE\u7F6E\u4E3B\u673A\u540D<br> \u57DF\u540D\u5199\u5165 host \u6587\u4EF6<br> \u65F6\u95F4\u540C\u6B65</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">timedatectl set</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">timezone Asia</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">Shanghai</span></span>
<span class="line"><span style="color:#A6ACCD;">sudo apt install </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">y ntpsec</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">ntpdate</span></span>
<span class="line"><span style="color:#A6ACCD;">ntpdate ntp</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">aliyun</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">com</span></span>
<span class="line"></span></code></pre></div><p>\u914D\u7F6E\u5185\u6838\u8F6C\u53D1\u548C\u7F51\u6865\u8FC7\u6EE4</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// \u751F\u6210\u914D\u7F6E</span></span>
<span class="line"><span style="color:#A6ACCD;">cat </span><span style="color:#89DDFF;">&lt;&lt;</span><span style="color:#A6ACCD;"> EOF </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> tee </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">etc</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">sysctl</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">d</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">k8s</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">conf</span></span>
<span class="line"><span style="color:#A6ACCD;">net</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">bridge</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">bridge</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">nf</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">call</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">ip6tables </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#A6ACCD;">net</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">bridge</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">bridge</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">nf</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">call</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">iptables </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#A6ACCD;">net</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ipv4</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ip_forward </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#A6ACCD;">EOF</span></span>
<span class="line"><span style="color:#676E95;">// \u5982\u4E0A\u914D\u7F6E\u9700\u8981\u52A0\u5728\u5982\u4E0B\u4E24\u4E2A\u6A21\u5757</span></span>
<span class="line"><span style="color:#A6ACCD;">modprobe overlay</span></span>
<span class="line"><span style="color:#A6ACCD;">modprobe br_netfilter</span></span>
<span class="line"><span style="color:#676E95;">// \u5199\u5230\u914D\u7F6E\u6587\u4EF6\uFF0C\u6C38\u4E45\u751F\u6548</span></span>
<span class="line"><span style="color:#A6ACCD;">cat </span><span style="color:#89DDFF;">&lt;&lt;</span><span style="color:#A6ACCD;"> EOF </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> tee </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">etc</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">modules</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">load</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">d</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">k8s</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">conf</span></span>
<span class="line"><span style="color:#A6ACCD;">overlay</span></span>
<span class="line"><span style="color:#A6ACCD;">br_netfilter</span></span>
<span class="line"><span style="color:#A6ACCD;">EOF</span></span>
<span class="line"><span style="color:#676E95;">// \u5E94\u7528\u914D\u7F6E</span></span>
<span class="line"><span style="color:#A6ACCD;">sysctl </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">system</span></span>
<span class="line"></span></code></pre></div><p>\u5B89\u88C5 ipvs<br> \u5173\u95ED swap \u5206\u533A</p><h2 id="\u4E09\u3001\u5B89\u88C5\u5BB9\u5668\u8FD0\u884C\u65F6" tabindex="-1">\u4E09\u3001\u5B89\u88C5\u5BB9\u5668\u8FD0\u884C\u65F6 <a class="header-anchor" href="#\u4E09\u3001\u5B89\u88C5\u5BB9\u5668\u8FD0\u884C\u65F6" aria-hidden="true">#</a></h2><p>docker</p><p>containerd</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// \u9996\u5148\u5B89\u88C5\u5BB9\u5668\u4F9D\u8D56\u9879</span></span>
<span class="line"><span style="color:#A6ACCD;">apt install </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">y curl gnupg2 software</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">properties</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">common apt</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">transport</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">https ca</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">certificates</span></span>
<span class="line"><span style="color:#676E95;">// \u6DFB\u52A0 containerd \u5B58\u50A8\u5E93</span></span>
<span class="line"><span style="color:#A6ACCD;">curl </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">fsSL </span><span style="color:#FFCB6B;">https</span><span style="color:#89DDFF;">:</span><span style="color:#676E95;">//download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmour -o /etc/apt/trusted.gpg.d/containerd.gpg</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">add</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">apt</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">repository </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// \u5B89\u88C5containerd.io</span></span>
<span class="line"><span style="color:#A6ACCD;">apt install containerd</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">io </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">y</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// \u914D\u7F6E containerd \u4F7F\u7528 SystemdCgroup</span></span>
<span class="line"><span style="color:#A6ACCD;">containerd config </span><span style="color:#89DDFF;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">  tee </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">etc</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">containerd</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">config</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">toml </span><span style="color:#89DDFF;">&gt;/</span><span style="color:#A6ACCD;">dev</span><span style="color:#89DDFF;">/null</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">&gt;&amp;</span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#676E95;">// \u547D\u4EE4\u5F0F\u4FEE\u6539</span></span>
<span class="line"><span style="color:#A6ACCD;">sed </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">i </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">s/SystemdCgroup </span><span style="color:#A6ACCD;">\\=</span><span style="color:#C3E88D;"> false/SystemdCgroup </span><span style="color:#A6ACCD;">\\=</span><span style="color:#C3E88D;"> true/g</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">etc</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">containerd</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">config</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">toml</span></span>
<span class="line"><span style="color:#676E95;">// \u8FDB\u5165\u6587\u4EF6\u4FEE\u6539</span></span>
<span class="line"><span style="color:#A6ACCD;">vim </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">etc</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">containerd</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">config</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">toml</span></span>
<span class="line"><span style="color:#676E95;">// \u4FEE\u6539\u6C99\u7BB1\u7248\u672C</span></span>
<span class="line"><span style="color:#A6ACCD;">sandbox_image </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">registry.aliyuncs.com/google_containers/pause:3.10</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// \u914D\u7F6E containerd \u5F00\u673A\u542F\u52A8,\u5E76\u542F\u52A8containerd</span></span>
<span class="line"><span style="color:#A6ACCD;">systemctl enable containerd </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">now</span></span>
<span class="line"></span></code></pre></div><h2 id="\u56DB\u3001\u5B89\u88C5-\u90E8\u7F72-k8s-\u96C6\u7FA4" tabindex="-1">\u56DB\u3001\u5B89\u88C5&amp;\u90E8\u7F72 k8s \u96C6\u7FA4 <a class="header-anchor" href="#\u56DB\u3001\u5B89\u88C5-\u90E8\u7F72-k8s-\u96C6\u7FA4" aria-hidden="true">#</a></h2><p>\u57FA\u672C\u5DE5\u5177</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">apt update</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">apt install </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">y apt</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">transport</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">https ca</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">certificates curl gpg</span></span>
<span class="line"></span></code></pre></div><p>\u6DFB\u52A0 Kubernetes Package Repository</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// \u63D0\u793Acurl: (7) Failed to connect to prod-cdn.packages.k8s.io port 443 after 75048 ms: Couldn&#39;t connect to server gpg: \u627E\u4E0D\u5230\u6709\u6548\u7684 OpenPGP \u6570\u636E</span></span>
<span class="line"><span style="color:#676E95;">// \u6362\u6210\u963F\u91CC\u7684\u5730\u5740</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">curl </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">fsSL </span><span style="color:#FFCB6B;">https</span><span style="color:#89DDFF;">:</span><span style="color:#676E95;">//mirrors.tuna.tsinghua.edu.cn/kubernetes/core:/stable:/v1.32/deb/Release.key | sudo gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">echo </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://mirrors.tuna.tsinghua.edu.cn/kubernetes/core:/stable:/v1.32/deb/ /</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> sudo tee </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">etc</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">apt</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">sources</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">list</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">d</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">kubernetes</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">list</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// \u6E90(\u8BBF\u95EE\u4E0D\u4E86\u5916\u7F51\u4E0D\u5EFA\u8BAE\u4F7F\u7528)</span></span>
<span class="line"><span style="color:#A6ACCD;">curl </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">fsSL </span><span style="color:#FFCB6B;">https</span><span style="color:#89DDFF;">:</span><span style="color:#676E95;">//pkgs.k8s.io/core:/stable:/v1.32/deb/Release.key | sudo gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">echo </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.32/deb/ /</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> sudo tee </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">etc</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">apt</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">sources</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">list</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">d</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">kubernetes</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">list</span></span>
<span class="line"></span></code></pre></div><p>\u5B89\u88C5 Kubernetes \u90E8\u4EF6 (Kubeadm, kubelet &amp; kubectl)</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">apt</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">get install </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">y kubelet kubeadm kubectl</span></span>
<span class="line"></span></code></pre></div><p>\u521D\u59CB\u5316\u96C6\u7FA4</p><ul><li>\u65B9\u6CD5\u4E00\uFF1A\u751F\u6210\u914D\u7F6E\u6587\u4EF6</li></ul><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#676E95;">// \u5728\u4E3B\u673A\u8282\u70B9\u62C9\u53D6\u6240\u9700\u955C\u50CF</span></span>
<span class="line"><span style="color:#A6ACCD;">kubeadm config images pull </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">image</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">repository</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">registry</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">aliyuncs</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">com</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">google_containers </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">kubernetes</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">version</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">v1</span><span style="color:#89DDFF;">.</span><span style="color:#F78C6C;">32.3</span></span>
<span class="line"><span style="color:#676E95;">// \u751F\u6210\u9ED8\u8BA4\u914D\u7F6E\u6587\u4EF6\u914D\u7F6E</span></span>
<span class="line"><span style="color:#A6ACCD;">kubeadm config print init</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">defaults </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> kubeadm</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">yaml</span></span>
<span class="line"><span style="color:#676E95;">// \u4FEE\u6539\u914D\u7F6E\u6587\u4EF6</span></span>
<span class="line"><span style="color:#FFCB6B;">apiVersion</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> kubeadm</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">k8s</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">io</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">v1beta4</span></span>
<span class="line"><span style="color:#FFCB6B;">bootstrapTokens</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">groups</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">system</span><span style="color:#89DDFF;">:</span><span style="color:#FFCB6B;">bootstrappers</span><span style="color:#89DDFF;">:</span><span style="color:#FFCB6B;">kubeadm</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;">default</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">node</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">token</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">token</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> abcdef</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">0123456789abcdef</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">ttl</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> 24h0m0s</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">usages</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> signing</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> authentication</span></span>
<span class="line"><span style="color:#FFCB6B;">kind</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> InitConfiguration</span></span>
<span class="line"><span style="color:#FFCB6B;">localAPIEndpoint</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">advertiseAddress</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">10.211</span><span style="color:#89DDFF;">.</span><span style="color:#F78C6C;">55.6</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">bindPort</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">6443</span></span>
<span class="line"><span style="color:#FFCB6B;">nodeRegistration</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">criSocket</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">unix</span><span style="color:#89DDFF;">:</span><span style="color:#676E95;">///var/run/containerd/containerd.sock</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">imagePullPolicy</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> IfNotPresent</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">imagePullSerial</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> k8smaster</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">taints</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null</span></span>
<span class="line"><span style="color:#FFCB6B;">timeouts</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">controlPlaneComponentHealthCheck</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> 4m0s</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">discovery</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> 5m0s</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">etcdAPICall</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> 2m0s</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">kubeletHealthCheck</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> 4m0s</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">kubernetesAPICall</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> 1m0s</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">tlsBootstrap</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> 5m0s</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">upgradeManifests</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> 5m0s</span></span>
<span class="line"><span style="color:#89DDFF;">---</span></span>
<span class="line"><span style="color:#FFCB6B;">apiServer</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#FFCB6B;">apiVersion</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> kubeadm</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">k8s</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">io</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">v1beta4</span></span>
<span class="line"><span style="color:#FFCB6B;">caCertificateValidityPeriod</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> 87600h0m0s</span></span>
<span class="line"><span style="color:#FFCB6B;">certificateValidityPeriod</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> 8760h0m0s</span></span>
<span class="line"><span style="color:#FFCB6B;">certificatesDir</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">etc</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">kubernetes</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">pki</span></span>
<span class="line"><span style="color:#FFCB6B;">clusterName</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> kubernetes</span></span>
<span class="line"><span style="color:#FFCB6B;">controllerManager</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#FFCB6B;">dns</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#FFCB6B;">encryptionAlgorithm</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> RSA</span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">2048</span></span>
<span class="line"><span style="color:#FFCB6B;">etcd</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">local</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">dataDir</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">/</span><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;">/lib/etcd</span></span>
<span class="line"><span style="color:#FFCB6B;">imageRepository</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> registry</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">aliyuncs</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">com</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">google_containers</span></span>
<span class="line"><span style="color:#FFCB6B;">kind</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> ClusterConfiguration</span></span>
<span class="line"><span style="color:#FFCB6B;">kubernetesVersion</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1.32</span><span style="color:#89DDFF;">.</span><span style="color:#F78C6C;">3</span></span>
<span class="line"><span style="color:#FFCB6B;">networking</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">dnsDomain</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> cluster</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">local</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">podSubnet</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">10.224</span><span style="color:#89DDFF;">.</span><span style="color:#F78C6C;">0.0</span><span style="color:#89DDFF;">/</span><span style="color:#F78C6C;">16</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">serviceSubnet</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">10.96</span><span style="color:#89DDFF;">.</span><span style="color:#F78C6C;">0.0</span><span style="color:#89DDFF;">/</span><span style="color:#F78C6C;">12</span></span>
<span class="line"><span style="color:#FFCB6B;">proxy</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#FFCB6B;">scheduler</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#89DDFF;">---</span></span>
<span class="line"><span style="color:#FFCB6B;">apiVersion</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> kubeproxy</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">config</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">k8s</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">io</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">v1alpha1</span></span>
<span class="line"><span style="color:#FFCB6B;">kind</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> KubeProxyConfiguration</span></span>
<span class="line"><span style="color:#FFCB6B;">mode</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> ipvs</span></span>
<span class="line"><span style="color:#89DDFF;">---</span></span>
<span class="line"><span style="color:#FFCB6B;">apiVersion</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> kubelet</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">config</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">k8s</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">io</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">v1beta1</span></span>
<span class="line"><span style="color:#FFCB6B;">kind</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> KubeletConfiguration</span></span>
<span class="line"><span style="color:#FFCB6B;">cgroupDriver</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> systemd</span></span>
<span class="line"><span style="color:#A6ACCD;">                        </span></span>
<span class="line"><span style="color:#676E95;">// \u901A\u8FC7\u914D\u7F6E\u6587\u4EF6\u521D\u59CB\u5316 Kubernetes\u96C6\u7FA4</span></span>
<span class="line"><span style="color:#A6ACCD;">kubeadm init </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">config</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">kubeadm</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">yaml</span></span>
<span class="line"></span></code></pre></div><ul><li>\u65B9\u6CD5\u4E8C\uFF1A\u624B\u52A8\u914D\u7F6E</li></ul><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">kubeadm init </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">kubernetes</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">version</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1.32</span><span style="color:#89DDFF;">.</span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">control</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">plane</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">endpoint</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">k8smaster </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">apiserver</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">advertise</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">address</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">10.211</span><span style="color:#89DDFF;">.</span><span style="color:#F78C6C;">55.6</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">pod</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">network</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">cidr</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">10.244</span><span style="color:#89DDFF;">.</span><span style="color:#F78C6C;">0.0</span><span style="color:#89DDFF;">/</span><span style="color:#F78C6C;">16</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">service</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">cidr</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">10.96</span><span style="color:#89DDFF;">.</span><span style="color:#F78C6C;">0.0</span><span style="color:#89DDFF;">/</span><span style="color:#F78C6C;">12</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">image</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">repository</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">registry</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">aliyuncs</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">com</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">google_containers </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">cri</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">socket</span><span style="color:#89DDFF;">=</span><span style="color:#FFCB6B;">unix</span><span style="color:#89DDFF;">:</span><span style="color:#676E95;">///var/run/containerd/containerd.sock --upload-certs --v=9</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// kubernetes-version\uFF1A\u6307\u5B9Ak8s\u7684\u7248\u672C\uFF0C\u6211\u8FD9\u91CC\u662F1.32.2\uFF0C\u4F60\u7684\u4E5F\u8BB8\u662F1.31.1-1.1\u7B49</span></span>
<span class="line"><span style="color:#676E95;">// control-plane-endpoint\uFF1A\u53EF\u4EE5\u7406\u89E3\u4E3A\u96C6\u7FA4master\u7684\u547D\u540D\uFF0C\u968F\u610F\u5199\u5373\u53EF</span></span>
<span class="line"><span style="color:#676E95;">// apiserver-advertise-address\uFF1A\u96C6\u7FA4\u4E2Dmaster\u7684\u5730\u5740\uFF01\u6CE8\u610F\u4E0D\u8981\u6284\uFF0C\u5199\u4F60\u81EA\u5DF1\u865A\u62DF\u673A\u7684ip\u5730\u5740</span></span>
<span class="line"><span style="color:#676E95;">// pod-network-cidr\uFF1Apod\u7F51\u6BB5\u5730\u5740\uFF0C4.6.1\u5DF2\u7ECF\u89C4\u5212\u8FC7\u4E86\uFF0C\u53EA\u8981\u4E0D\u4E0E\u96C6\u7FA4\u7F51\u6BB5\u548Cservice\u7F51\u6BB5\u91CD\u590D\u5373\u53EF</span></span>
<span class="line"><span style="color:#676E95;">// service-cidr\uFF1Aservice\u7F51\u6BB5\u5730\u5740\uFF0C4.6.1\u5DF2\u7ECF\u89C4\u5212\u8FC7\u4E86\uFF0C\u53EA\u8981\u4E0D\u4E0E\u96C6\u7FA4\u7F51\u6BB5\u548Cpod\u7F51\u6BB5\u91CD\u590D\u5373\u53EF</span></span>
<span class="line"><span style="color:#676E95;">// image-repository\uFF1A\u6307\u5B9A\u4F7F\u7528\u56FD\u5185\u955C\u50CF</span></span>
<span class="line"><span style="color:#676E95;">// cri-socket\uFF1A\u6307\u5B9A\u4F7F\u7528\u7684\u5BB9\u5668\u8FD0\u884C\u65F6\uFF0C\u5982\u679C\u4F60\u4F7F\u7528\u7684containerd\u5BB9\u5668\uFF0C\u90A3\u5C31\u4E0D\u7528\u5199\u8FD9\u4E2A\u53C2\u6570</span></span>
<span class="line"><span style="color:#676E95;">// v\uFF1A\u65E5\u5FD7\u7EA7\u522B\uFF0C9\u8868\u793A\u8F93\u51FA\u7684\u4FE1\u606F\u4F1A\u5F88\u8BE6\u7EC6</span></span>
<span class="line"></span></code></pre></div><p>containerd \u8FD0\u884C\u62A5\u9519\u8BF7\u8F93\u5165\u4EE5\u4E0B\u547D\u4EE4</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">journalctl </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">xeu containerd</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">service</span></span>
<span class="line"></span></code></pre></div><p>\u521D\u59CB\u5316\u6210\u529F\u540E\uFF0C\u5728 master \u8282\u70B9\u6267\u884C</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">mkdir </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">p $HOME</span><span style="color:#89DDFF;">/.</span><span style="color:#A6ACCD;">kube</span></span>
<span class="line"><span style="color:#A6ACCD;">sudo cp </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">i </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">etc</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">kubernetes</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">admin</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">conf $HOME</span><span style="color:#89DDFF;">/.</span><span style="color:#A6ACCD;">kube</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">config</span></span>
<span class="line"><span style="color:#A6ACCD;">sudo chown </span><span style="color:#82AAFF;">$</span><span style="color:#A6ACCD;">(id </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">u):</span><span style="color:#82AAFF;">$</span><span style="color:#A6ACCD;">(id </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">g) $HOME</span><span style="color:#89DDFF;">/.</span><span style="color:#A6ACCD;">kube</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">config</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">systemctl restart containerd</span></span>
<span class="line"><span style="color:#676E95;">// \u67E5\u770B\u52A0\u5165\u8282\u70B9\u7684\u547D\u4EE4</span></span>
<span class="line"><span style="color:#A6ACCD;">kubeadm token create </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">print</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">join</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">command</span></span>
<span class="line"><span style="color:#676E95;">// \u5728\u8981\u52A0\u5165\u7684\u8282\u70B9\u4E0A\u6267\u884C\u4EE5\u4E0B\u547D\u4EE4(\u4E0B\u9762\u7684\u4EE3\u7801\u53EA\u662F\u4F8B\u5B50\uFF0C\u590D\u5236\u6700\u540E\u8F93\u51FA\u7684\u7ED3\u679C)</span></span>
<span class="line"><span style="color:#A6ACCD;">kubeadm join </span><span style="color:#F78C6C;">10.211</span><span style="color:#89DDFF;">.</span><span style="color:#F78C6C;">55.6</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">6443</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">token abcdef</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">0123456789abcdef </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">discovery</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">token</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">ca</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">cert</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">hash </span><span style="color:#FFCB6B;">sha256</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">8a8726500c529481a6ab4fa4e0a296ed9601efdafa38bccf4808cb360eb4a65a</span></span>
<span class="line"></span></code></pre></div><p>\u5B89\u88C5 calico</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">kubectl create </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">f </span><span style="color:#FFCB6B;">https</span><span style="color:#89DDFF;">:</span><span style="color:#676E95;">//raw.githubusercontent.com/projectcalico/calico/v3.29.2/manifests/tigera-operator.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">wget </span><span style="color:#FFCB6B;">https</span><span style="color:#89DDFF;">:</span><span style="color:#676E95;">//raw.githubusercontent.com/projectcalico/calico/v3.29.2/manifests/custom-resources.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">vim custom</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">resources</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">yaml</span></span>
<span class="line"><span style="color:#676E95;">// \u4FEE\u6539pod\u7F51\u6BB5 cidr: 10.244.0.0/16</span></span>
<span class="line"><span style="color:#A6ACCD;">kubectl create </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">f custom</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">resources</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">yaml</span></span>
<span class="line"><span style="color:#676E95;">// \u68C0\u67E5calico\u662F\u5426\u8FD0\u884C\u6210\u529F</span></span>
<span class="line"><span style="color:#A6ACCD;">kubectl get pod </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">n calico</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">system</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// \u68C0\u67E5\u73B0\u6709\u8D44\u6E90</span></span>
<span class="line"><span style="color:#A6ACCD;">kubectl get all </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">n tigera</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">operator</span></span>
<span class="line"><span style="color:#676E95;">// \u5220\u9664\u547D\u540D\u7A7A\u95F4</span></span>
<span class="line"><span style="color:#A6ACCD;">kubectl </span><span style="color:#89DDFF;">delete</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">namespace</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">tigera</span><span style="color:#A6ACCD;">-</span><span style="color:#FFCB6B;">operator</span></span>
<span class="line"><span style="color:#676E95;">// \u5220\u9664\u7279\u5B9A\u8D44\u6E90</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">delete</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">deployment</span><span style="color:#A6ACCD;"> -</span><span style="color:#FFCB6B;">n</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">tigera</span><span style="color:#A6ACCD;">-</span><span style="color:#FFCB6B;">operator</span><span style="color:#A6ACCD;"> &lt;</span><span style="color:#FFCB6B;">deployment</span><span style="color:#A6ACCD;">-</span><span style="color:#FFCB6B;">name</span><span style="color:#A6ACCD;">&gt;</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">delete</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">service</span><span style="color:#A6ACCD;"> -</span><span style="color:#FFCB6B;">n</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">tigera</span><span style="color:#A6ACCD;">-</span><span style="color:#FFCB6B;">operator</span><span style="color:#A6ACCD;"> &lt;</span><span style="color:#FFCB6B;">service</span><span style="color:#A6ACCD;">-</span><span style="color:#FFCB6B;">name</span><span style="color:#A6ACCD;">&gt;</span></span>
<span class="line"><span style="color:#676E95;">// \u5220\u9664\u6240\u6709 Calico CRD</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">get</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">crds</span><span style="color:#A6ACCD;"> | </span><span style="color:#FFCB6B;">grep</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">projectcalico</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">org</span><span style="color:#A6ACCD;"> | </span><span style="color:#FFCB6B;">awk</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">{print $1}</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> | </span><span style="color:#FFCB6B;">xargs</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">delete</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">crd</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// \u5B8C\u5168\u5220\u9664 Calico/Tigera</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">delete</span><span style="color:#A6ACCD;"> -</span><span style="color:#FFCB6B;">f</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">custom</span><span style="color:#A6ACCD;">-</span><span style="color:#FFCB6B;">resources</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">yaml</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">delete</span><span style="color:#A6ACCD;"> -</span><span style="color:#FFCB6B;">f</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">https</span><span style="color:#A6ACCD;">:</span><span style="color:#676E95;">//raw.githubusercontent.com/projectcalico/calico/v3.29.2/manifests/tigera-operator.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// \u67E5\u8BE2pod\u7684\u8FD0\u884C\u72B6\u6001</span></span>
<span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">describe</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">pod</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">tigera</span><span style="color:#A6ACCD;">-</span><span style="color:#FFCB6B;">operator</span><span style="color:#A6ACCD;">-</span><span style="color:#FFCB6B;">ccfc44587</span><span style="color:#A6ACCD;">-</span><span style="color:#FFCB6B;">wm2lb</span><span style="color:#A6ACCD;"> -</span><span style="color:#FFCB6B;">n</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">tigera</span><span style="color:#A6ACCD;">-</span><span style="color:#FFCB6B;">operator</span></span>
<span class="line"></span></code></pre></div><h2 id="\u56DE\u9000-k8s-\u96C6\u7FA4-\u91CD\u7F6E-k8s-\u96C6\u7FA4" tabindex="-1">\u56DE\u9000 k8s \u96C6\u7FA4/\u91CD\u7F6E k8s \u96C6\u7FA4 <a class="header-anchor" href="#\u56DE\u9000-k8s-\u96C6\u7FA4-\u91CD\u7F6E-k8s-\u96C6\u7FA4" aria-hidden="true">#</a></h2><p>k8s \u5B89\u88C5\u6B65\u9AA4\u786E\u5B9E\u7E41\u7410\uFF0C\u53EF\u80FD\u6211\u4EEC\u67D0\u4E00\u6B65\u9519\u4E86\uFF0C\u6216\u8005\u9047\u5230\u5404\u79CD\u95EE\u9898\uFF0C\u90FD\u5F97\u91CD\u5934\u518D\u6765\u592A\u9EBB\u70E6\u3002\u8FD9\u65F6\u6211\u4EEC\u53EF\u4EE5\u4F7F\u7528 kubeadm \u63D0\u4F9B\u7684 reset \u547D\u4EE4\u6765\u56DE\u9000\u96C6\u7FA4\u3002</p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">kubeadm reset</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">rm </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">rf </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">root</span><span style="color:#89DDFF;">/.</span><span style="color:#A6ACCD;">kube</span></span>
<span class="line"><span style="color:#A6ACCD;">rm </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">rf </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">etc</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">cni</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">net</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">d</span></span>
<span class="line"><span style="color:#A6ACCD;">rm </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">rf </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">etc</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">kubernetes</span><span style="color:#676E95;">/*</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">systemctl restart containerd/docker(\u533A\u5206\u5BB9\u5668\u8FD0\u884C\u65F6)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// \u5B50node\u6E05\u7406\u73B0\u6709 Kubernetes \u914D\u7F6E</span></span>
<span class="line"><span style="color:#676E95;">kubeadm reset</span></span>
<span class="line"><span style="color:#676E95;">rm -rf /etc/kubernetes /var/lib/kubelet /var/lib/etcd</span></span>
<span class="line"></span></code></pre></div><blockquote><p>\u53C2\u8003\u6587\u6863:<br><a href="https://juejin.cn/post/7473838374366347303#heading-31" target="_blank" rel="noreferrer">https://juejin.cn/post/7473838374366347303#heading-31</a> <a href="https://blog.csdn.net/qq_51773218/article/details/142130434" target="_blank" rel="noreferrer">https://blog.csdn.net/qq_51773218/article/details/142130434</a><br><a href="https://blog.csdn.net/master_boy/article/details/127148422" target="_blank" rel="noreferrer">k8s\u642D\u5EFA\u7684\u4E00\u4E9B\u95EE\u9898\u8BB0\u5F55</a></p></blockquote>`,35),e=[o];function c(t,r,D,y,C,F){return n(),a("div",null,e)}const d=s(p,[["render",c]]);export{i as __pageData,d as default};
